services:
  mongodb-container:
    image: mongo:latest
    container_name: mongodb-container
    ports:
      - 27017:27017
    volumes:
      - ../docker-compose/mongodb-init:/docker-entrypoint-initdb.d
    networks:
      - orders-service-network

  orders-microservice:
    image: visualfxvault-ordersservice
    build:
      context: .
      dockerfile: APILayer/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - USERS_SERVICE_HOST=http://users-microservice
      - USERS_SERVICE_PORT=5000
      - MONGO_HOST=mongodb-container
      - MONGO_PORT=27017
      - MONGO_DB=VisualFXVault_Orders
    ports:
      - 7000:8080
    networks:
      - orders-service-network
      - services-communication-network
    depends_on:
      - mongodb-container

  sqlserver-container:
    image: mcr.microsoft.com/mssql/server:latest
    container_name: sqlserver-container
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=pa55w0Rd
    hostname: sqlserver-container
    ports:
      - "1434:1433"
    networks:
      - products-service-network

  products-microservice:
    image: visualfxvault-productsservice:initial
    ports:
      - "6000:8080"
    environment:
      - ASPNETCORE_HTTP_PORT=8080
      - ASPNETCORE_ENVIRONMENT=Development
      - SQLSERVER_HOST=sqlserver-container
      - SQLSERVER_PORT=1433
      - SQLSERVER_DATABASE=VisualFXVault.ProductsService
      - SQLSERVER_USER=sa
      - SQLSERVER_PASSWORD=pa55w0Rd
    networks:
      - products-service-network
      - services-communication-network
    depends_on:
      - sqlserver-container

  postgres-container:
    image: postgres:17.4
    container_name: postgres-container
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_DB=VisualFXVaultUsers
      - POSTGRES_PASSWORD=pa55w0Rd
    hostname: postgres-container
    ports:
      - "5433:5432"
    networks:
      - users-service-network
    volumes: 
      - ../docker-compose/postgres-init:/docker-entrypoint-initdb.d

  users-microservice:
    image: visualfxvault-usersservice:initial
    ports:
      - "5000:8080"
    environment:
      - ASPNETCORE_HTTP_PORT=8080
      - ASPNETCORE_ENVIRONMENT=Development
      - POSTGRES_HOST=postgres-container
      - POSTGRES_PORT=5432
      - POSTGRES_DB=VisualFXVaultUsers
      - POSTGRES_PASSWORD=yourStrong(!)Password
      - POSTGRES_USER=postgres
    networks:
      - users-service-network
      - services-communication-network
    depends_on:
      - postgres-container
    
networks:
  orders-service-network:
    driver: bridge
  products-service-network:
    driver: bridge
  users-service-network:
    driver: bridge
  services-communication-network:
    driver: bridge